Молодец, постарался!

Но при этом решение мне не нравится, чистый говнокод. Проверять его было тяжелее всего из-за этого. 

Поддерживаемость и изменяемость продукта всегда стоит на первом месте, гораздо выше любых свистелок и перделок, учти это, пожалуйста, выполняя дальнейшие домашки :-)
